<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Guild Profile - BAMACO</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/tailwind-config.js"></script>
    <script>tailwind.config = window.BAMACO_TAILWIND_CONFIG;</script>

    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body class="bg-bg-primary text-text-primary font-sans antialiased overflow-x-hidden">
    <!-- Navbar will be dynamically generated by navbar.js -->

    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
      <!-- Loading state -->
      <div id="loading-container" class="text-center py-12">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-accent-pink mx-auto mb-4"></div>
        <p class="text-text-secondary">Loading guild profile...</p>
      </div>

      <!-- Guild content -->
      <div id="guild-content" class="hidden">
        <!-- Guild header -->
        <div class="bg-gradient-to-br from-white/5 to-white/0 rounded-2xl p-8 mb-8 relative overflow-hidden">
          <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full animate-[shimmer_3s_infinite]"></div>
          <div class="relative z-10">
            <h1 id="guild-name" class="text-4xl sm:text-5xl lg:text-6xl font-black mb-4 bg-gradient-to-br from-accent-pink to-accent-purple bg-clip-text text-transparent"></h1>
            <p id="guild-motto" class="text-lg sm:text-xl text-text-secondary mb-6"></p>
            <div class="flex flex-wrap gap-4 text-sm">
              <span class="bg-bg-card px-3 py-1 rounded-full">
                <span id="guild-member-count">0</span> Members
              </span>
              <span class="bg-bg-card px-3 py-1 rounded-full">
                Est. <span id="guild-established">2025</span>
              </span>
              <span class="bg-bg-card px-3 py-1 rounded-full">
                Level <span id="guild-level">0</span>
              </span>
            </div>
          </div>
        </div>

        <!-- Guild description -->
        <div class="bg-bg-card border border-border-primary rounded-xl p-6 mb-8">
          <h2 class="text-2xl font-bold mb-4">About This Guild</h2>
          <p id="guild-description" class="text-text-secondary leading-relaxed"></p>
        </div>

        <!-- Members section -->
        <div class="bg-bg-card border border-border-primary rounded-xl p-6">
          <h2 class="text-2xl font-bold mb-6">Guild Members</h2>
          <div id="members-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4"></div>
          <div id="no-members" class="text-center py-8 text-text-muted hidden">
            No members found for this guild.
          </div>
        </div>
      </div>

      <!-- Error state -->
      <div id="error-container" class="hidden text-center py-12">
        <div class="text-6xl mb-4">‚ùå</div>
        <h2 class="text-2xl font-bold mb-2">Guild Not Found</h2>
        <p class="text-text-secondary mb-6">The requested guild could not be found.</p>
        <a href="guilds.html" class="inline-block bg-accent-pink hover:bg-accent-purple text-white px-6 py-3 rounded-lg transition-colors">
          View All Guilds
        </a>
      </div>
    </main>

    <footer class="border-t border-border-primary py-6 mt-12 bg-bg-secondary">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center">
        <p class="text-text-muted">
          &copy; 2026 BAMACO - Bataan MaiMai Community. All rights reserved.
        </p>
      </div>
    </footer>

    <script src="assets/page-transitions.js"></script>
    <script src="assets/script.js" type="module"></script>
    <script src="assets/navbar.js"></script>
    <script type="module">
      import { guildsDB } from './assets/guilds-db.js';
      import { playersDB } from './assets/players-db.js';

      document.addEventListener('DOMContentLoaded', async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const guildId = urlParams.get('id');

        if (!guildId) {
          showError();
          return;
        }

        try {
          // Load guild data
          const guild = await guildsDB.getGuild(guildId);

          if (!guild) {
            showError();
            return;
          }

          // Load all players to find guild members
          const allPlayers = await playersDB.getAllPlayers();
          const guildMembers = allPlayers.filter(player => player.guildId === guildId);

          displayGuild(guild, guildMembers);

        } catch (error) {
          console.error('Error loading guild:', error);
          showError();
        }
      });

      function displayGuild(guild, members) {
        // Hide loading, show content
        document.getElementById('loading-container').classList.add('hidden');
        document.getElementById('guild-content').classList.remove('hidden');

        // Update page title
        document.title = `${guild.name} - BAMACO`;

        // Populate guild info
        document.getElementById('guild-name').textContent = guild.name;
        document.getElementById('guild-motto').textContent = guild.motto || 'No motto set';
        document.getElementById('guild-member-count').textContent = members.length;
        document.getElementById('guild-established').textContent = guild.established || '2025';
        document.getElementById('guild-level').textContent = guild.level || '0';
        document.getElementById('guild-description').textContent = guild.description || 'No description available.';

        // Display members
        const membersGrid = document.getElementById('members-grid');
        const noMembersDiv = document.getElementById('no-members');

        if (members.length === 0) {
          membersGrid.classList.add('hidden');
          noMembersDiv.classList.remove('hidden');
        } else {
          membersGrid.innerHTML = members.map(member => createMemberCard(member)).join('');
        }
      }

      function createMemberCard(member) {
        const profileId = member.friendCode || member.id;
        const displayName = member.ign || member.name;
        const avatarContent = member.avatarImage && member.avatarImage.trim()
          ? `<img src="${member.avatarImage}" alt="${displayName}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextSibling.style.display='flex';" /><div class="w-full h-full flex items-center justify-center text-white font-bold" style="display:none;">${displayName.substring(0, 2).toUpperCase()}</div>`
          : `<div class="w-full h-full flex items-center justify-center text-white font-bold">${displayName.substring(0, 2).toUpperCase()}</div>`;
        return `
          <a href="player-profile.html?id=${profileId}"
             class="block bg-bg-secondary border border-border-primary rounded-lg p-4 hover-card hover:shadow-lg transition-all duration-300">
            <div class="flex items-center gap-3 mb-2">
              <div class="w-12 h-12 flex items-center justify-center font-bold text-sm flex-shrink-0 overflow-hidden">
                ${avatarContent}
              </div>
              <div class="flex-1 min-w-0">
                <h4 class="text-base font-semibold truncate">${displayName}</h4>
                <p class="text-text-muted text-sm truncate">${member.role || 'Member'}</p>
              </div>
            </div>
            ${member.rating ? `<div class="inline-block bg-bg-tertiary px-2 py-1 rounded-full text-xs font-semibold">Rating: ${member.rating}</div>` : ''}
          </a>
        `;
      }

      function showError() {
        document.getElementById('loading-container').classList.add('hidden');
        document.getElementById('error-container').classList.remove('hidden');
      }
    </script>
  </body>
</html>
