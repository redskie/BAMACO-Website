<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Article - BAMACO</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/tailwind-config.js"></script>
    <script>tailwind.config = window.BAMACO_TAILWIND_CONFIG;</script>

    <link rel="stylesheet" href="assets/styles.css" />
  </head>
  <body class="bg-bg-primary text-text-primary font-sans antialiased overflow-x-hidden">
    <!-- Navbar will be dynamically generated by navbar.js -->

    <main class="max-w-4xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
      <!-- Loading state -->
      <div id="loading-container" class="text-center py-12">
        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-accent-pink mx-auto mb-4"></div>
        <p class="text-text-secondary">Loading article...</p>
      </div>

      <!-- Article content -->
      <div id="article-content" class="hidden">
        <!-- Back button -->
        <div class="mb-6">
          <a href="articles.html" class="inline-flex items-center gap-2 text-text-secondary hover:text-text-primary transition-colors">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
            </svg>
            Back to Articles
          </a>
        </div>

        <!-- Article header -->
        <div class="bg-gradient-to-br from-white/5 to-white/0 rounded-2xl p-8 mb-8 relative overflow-hidden">
          <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full animate-[shimmer_3s_infinite]"></div>
          <div class="relative z-10">
            <div class="flex flex-wrap gap-2 mb-4">
              <span id="article-category" class="bg-accent-pink/20 text-accent-pink px-3 py-1 rounded-full text-sm font-semibold"></span>
            </div>
            <h1 id="article-title" class="text-3xl sm:text-4xl lg:text-5xl font-black mb-4 bg-gradient-to-br from-accent-pink to-accent-purple bg-clip-text text-transparent"></h1>
            <div class="flex flex-wrap gap-4 text-sm text-text-muted">
              <span>By <span id="article-author" class="text-text-secondary font-semibold"></span></span>
              <span id="article-date"></span>
            </div>
          </div>
        </div>

        <!-- Article body -->
        <div class="bg-bg-card border border-border-primary rounded-xl p-6 sm:p-8 mb-8">
          <div id="article-excerpt" class="text-lg text-text-secondary mb-6 italic leading-relaxed"></div>
          <div id="article-body" class="prose prose-invert prose-pink max-w-none">
            <!-- Article content will be inserted here -->
          </div>
        </div>

        <!-- Related articles -->
        <div class="bg-bg-card border border-border-primary rounded-xl p-6">
          <h2 class="text-2xl font-bold mb-6">Related Articles</h2>
          <div id="related-articles" class="grid grid-cols-1 sm:grid-cols-2 gap-4"></div>
        </div>
      </div>

      <!-- Error state -->
      <div id="error-container" class="hidden text-center py-12">
        <div class="text-6xl mb-4">ðŸ“„</div>
        <h2 class="text-2xl font-bold mb-2">Article Not Found</h2>
        <p class="text-text-secondary mb-6">The requested article could not be found.</p>
        <a href="articles.html" class="inline-block bg-accent-pink hover:bg-accent-purple text-white px-6 py-3 rounded-lg transition-colors">
          View All Articles
        </a>
      </div>
    </main>

    <footer class="border-t border-border-primary py-6 mt-12 bg-bg-secondary">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center">
        <p class="text-text-muted">
          &copy; 2026 BAMACO - Bataan MaiMai Community. All rights reserved.
        </p>
      </div>
    </footer>

    <script src="assets/page-transitions.js"></script>
    <script src="assets/script.js" type="module"></script>
    <script src="assets/navbar.js"></script>
    <script type="module">
      import { articlesDB } from './assets/articles-db.js';

      document.addEventListener('DOMContentLoaded', async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const articleId = urlParams.get('id');

        if (!articleId) {
          showError();
          return;
        }

        try {
          // Load article data
          const article = await articlesDB.getArticle(articleId);

          if (!article) {
            showError();
            return;
          }

          // Load related articles (same category, excluding current)
          const allArticles = await articlesDB.getAllArticles();
          const relatedArticles = allArticles
            .filter(a => a.id !== articleId && a.category === article.category)
            .slice(0, 4);

          displayArticle(article, relatedArticles);

        } catch (error) {
          console.error('Error loading article:', error);
          showError();
        }
      });

      function displayArticle(article, relatedArticles) {
        // Hide loading, show content
        document.getElementById('loading-container').classList.add('hidden');
        document.getElementById('article-content').classList.remove('hidden');

        // Update page title
        document.title = `${article.title} - BAMACO`;

        // Populate article info
        document.getElementById('article-title').textContent = article.title;
        document.getElementById('article-category').textContent = article.category || 'Guide';
        document.getElementById('article-author').textContent = article.authorId || 'Anonymous';
        document.getElementById('article-date').textContent = article.date || 'Recently';
        document.getElementById('article-excerpt').textContent = article.excerpt || '';

        // Display article content
        const articleBody = document.getElementById('article-body');
        if (article.content) {
          articleBody.innerHTML = article.content;
        } else {
          articleBody.innerHTML = '<p class="text-text-muted">Content not available.</p>';
        }

        // Display related articles
        const relatedContainer = document.getElementById('related-articles');
        if (relatedArticles.length > 0) {
          relatedContainer.innerHTML = relatedArticles.map(article => createRelatedArticleCard(article)).join('');
        } else {
          relatedContainer.innerHTML = '<p class="text-text-muted col-span-full text-center py-4">No related articles found.</p>';
        }
      }

      function createRelatedArticleCard(article) {
        return `
          <a href="article.html?id=${article.id}"
             class="block bg-bg-secondary border border-border-primary rounded-lg p-4 hover-card hover:shadow-lg transition-all duration-300">
            <div class="mb-2">
              <span class="bg-accent-pink/20 text-accent-pink px-2 py-1 rounded text-xs font-semibold">
                ${article.category || 'Guide'}
              </span>
            </div>
            <h4 class="text-base font-semibold mb-2 line-clamp-2">${article.title}</h4>
            <p class="text-text-muted text-sm line-clamp-3">${article.excerpt || 'No excerpt available.'}</p>
          </a>
        `;
      }

      function showError() {
        document.getElementById('loading-container').classList.add('hidden');
        document.getElementById('error-container').classList.remove('hidden');
      }
    </script>
  </body>
</html>
