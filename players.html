<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Players - BAMACO</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

        <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="assets/tailwind-config.js"></script>
    <script>tailwind.config = window.BAMACO_TAILWIND_CONFIG;</script>

    <link rel="stylesheet" href="assets/styles.css" />
  </head>

  <body class="bg-bg-primary text-text-primary font-sans antialiased">
    <!-- Navbar will be dynamically generated by navbar.js -->

    <main class="max-w-7xl mx-auto px-4 sm:px-6 py-8 sm:py-12">
      <!-- Page Header -->
      <div class="text-center py-8 sm:py-12 bg-gradient-to-br from-white/5 to-white/0 rounded-2xl mb-8 relative overflow-hidden">
        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/5 to-transparent -translate-x-full animate-[shimmer_3s_infinite]"></div>
        <h2 class="text-4xl sm:text-5xl lg:text-6xl font-black mb-4 bg-gradient-to-br from-accent-pink to-accent-purple bg-clip-text text-transparent relative z-10">
          Community Players
        </h2>
        <p class="text-lg sm:text-xl text-text-secondary relative z-10">
          Meet the talented players of our community
        </p>
      </div>

      <!-- Search Bar -->
      <div class="max-w-2xl mx-auto mb-8 relative">
        <div class="absolute left-4 top-1/2 -translate-y-1/2 text-2xl pointer-events-none">üîç</div>
        <input
          type="text"
          id="player-search"
          placeholder="Search players..."
          class="w-full pl-14 pr-6 py-4 bg-bg-card border-2 border-border-primary rounded-xl text-text-primary text-base sm:text-lg transition-all duration-300 focus:outline-none focus:border-text-secondary focus:-translate-y-0.5 focus:shadow-[0_8px_24px_rgba(0,0,0,0.3)] placeholder:text-text-muted"
        />
      </div>

      <!-- Players Grid -->
      <div id="players-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6"></div>
    </main>

    <footer class="border-t border-border-primary py-8 mt-16 bg-gradient-to-r from-bg-card to-bg-secondary shadow-lg">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 text-center text-text-muted">
        <p>&copy; 2026 BAMACO - Bataan MaiMai Community. All rights reserved.</p>
      </div>
    </footer>

    <script src="assets/script.js" type="module"></script>
    <script src="assets/page-transitions.js"></script>
    <script src="assets/navbar.js"></script>

    <script type="module">
      import { playersDB } from './assets/players-db.js';

      let allPlayers = [];

      document.addEventListener('DOMContentLoaded', () => {
        loadAllPlayers();

        // Search functionality
        document.getElementById('player-search').addEventListener('input', (e) => {
          filterPlayers(e.target.value);
        });
      });

      async function loadAllPlayers() {
        const grid = document.getElementById('players-grid');

        // Show loading state
        grid.innerHTML = `
          <div class="col-span-full text-center py-12">
            <div class="w-12 h-12 border-4 border-accent-pink border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-text-secondary">Loading players...</p>
          </div>
        `;

        // Subscribe to real-time updates
        playersDB.subscribeToPlayers((players) => {
          allPlayers = players;
          renderPlayers(players);
        });
      }

      function renderPlayers(players) {
        const grid = document.getElementById('players-grid');

        if (players.length === 0) {
          grid.innerHTML = `
            <div class="col-span-full text-center py-12">
              <div class="text-5xl mb-4">üéÆ</div>
              <p class="text-text-secondary text-lg">No players found</p>
              <a href="create-profile.html" class="inline-block mt-4 bg-accent-pink hover:bg-accent-purple text-white font-bold py-2 px-6 rounded-lg transition-colors">
                Be the first to join!
              </a>
            </div>
          `;
          return;
        }

        grid.innerHTML = players.map((player, index) => {
          const displayName = player.ign || player.name || 'Unknown';
          const avatarContent = player.avatarImage && player.avatarImage.trim()
            ? `<img src="${player.avatarImage}" alt="${displayName}" class="w-full h-full object-cover rounded-full" onerror="this.style.display='none'; this.nextSibling.style.display='flex';" /><div class="w-full h-full rounded-full bg-gradient-to-br from-accent-pink to-accent-purple flex items-center justify-center text-white font-bold" style="display:none;">${displayName.substring(0, 2).toUpperCase()}</div>`
            : `<div class="w-full h-full rounded-full bg-gradient-to-br from-accent-pink to-accent-purple flex items-center justify-center text-white font-bold">${displayName.substring(0, 2).toUpperCase()}</div>`;

          // Link to dynamic profile page with friendCode
          const profileUrl = `player-profile.html?id=${player.friendCode}`;

          return `
            <a href="${profileUrl}"
               class="block bg-bg-card border border-border-primary rounded-xl p-6 hover-card hover-gradient-line group relative overflow-hidden animate-fade-in-up"
               style="animation-delay: ${Math.min(index * 0.05, 0.35)}s; opacity: 0;">
              <div class="absolute inset-0 h-1 top-0 bg-gradient-to-r from-accent-pink to-accent-purple scale-x-0 origin-left group-hover:scale-x-100 transition-transform duration-300"></div>

              <div class=\"w-20 h-20 mx-auto mb-4 bg-bg-tertiary rounded-full flex items-center justify-center text-3xl font-black border-4 border-accent-pink/20 transition-all duration-300 group-hover:border-text-secondary group-hover:scale-110 group-hover:rotate-6 overflow-hidden\">
                ${avatarContent}
              </div>

              <h3 class="text-lg font-bold text-center mb-3 truncate">${displayName}</h3>

              <div class="space-y-2">
                ${player.rating ? `
                <div class="flex justify-between items-center px-3 py-2 bg-bg-tertiary rounded-lg text-sm">
                  <span class="text-text-muted">Rating</span>
                  <span class="font-semibold">${player.rating}</span>
                </div>` : ''}
                ${player.title || player.motto ? `
                <div class="px-3 py-2 bg-bg-tertiary rounded-lg text-sm">
                  <span class="text-text-muted">Title</span>
                  <div class="mt-1">
                    ${(player.title || player.motto || '').length >= 25 ?
                      `<div class="marquee-container text-xs"><span class="marquee-content">${player.title || player.motto}</span></div>` :
                      `<span class="font-semibold">${player.title || player.motto}</span>`
                    }
                  </div>
                </div>` : ''}
                ${player.guildId ? `
                <div class="flex justify-between items-center px-3 py-2 bg-bg-tertiary rounded-lg text-sm">
                  <span class="text-text-muted">Guild</span>
                  <span class="font-semibold truncate ml-2">${player.guildId}</span>
                </div>` : ''}
              </div>
            </a>
          `;
        }).join('');
      }

      function filterPlayers(query) {
        if (!allPlayers.length) return;

        const searchText = query.toLowerCase().trim();

        if (!searchText) {
          renderPlayers(allPlayers);
          return;
        }

        const filtered = allPlayers.filter(player => {
          const displayName = (player.ign || player.name || '').toLowerCase();
          const nickname = (player.nickname || '').toLowerCase();
          const title = (player.title || player.motto || '').toLowerCase();
          return displayName.includes(searchText) ||
                 nickname.includes(searchText) ||
                 title.includes(searchText);
        });

        renderPlayers(filtered);
      }

      // Expose to window for non-module scripts
      window.filterPlayers = filterPlayers;
    </script>
  </body>
</html>
